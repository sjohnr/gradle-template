// -----------------------------------------------------------------------------
// Plugins to customize gradle
// -----------------------------------------------------------------------------

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'maven'

// -----------------------------------------------------------------------------
// Custom properties (see gradle.properties and settings.gradle for more)
// -----------------------------------------------------------------------------

sourceCompatibility = 1.7

// -----------------------------------------------------------------------------
// Custom configuration names (see below for uses)
// -----------------------------------------------------------------------------

configurations {
	allJars
	deployerJars
	allArchives
}

// -----------------------------------------------------------------------------
// Custom tasks
// -----------------------------------------------------------------------------

task jarAll(type: Jar) {
	description 'Assembles a jar file with dependencies included in the /lib directory of the jar.'
	
	baseName = archivesBaseName + '-all'
	into ('lib') {
		from {
			configurations.allJars
		}
	}
	with jar
}

task uploadAll(type: Upload, dependsOn: jarAll) {
	description 'Uploads the fat jar as an artifact.'
	
	configuration = configurations.allArchives
	repositories {
		mavenDeployer {
			configuration = configurations.deployerJars
			repository(url: "...") {
				authentication(userName: "...", password: "...")
			}
		}
	}
}

// -----------------------------------------------------------------------------
// Custom configurations
// -----------------------------------------------------------------------------

jar {
    manifest {
        attributes 'Implementation-Title': artifactId, 'Implementation-Version': version
    }
}

install {
	repositories.mavenInstaller {
		pom.version = version
		pom.groupId = groupId
		pom.artifactId = artifactId
	}
}

artifacts {
	allArchives jarAll
}

repositories {
	maven {
		url "http://repository.mapr.com/nexus/content/groups/mapr-public/"
	}
	
	mavenCentral()
	mavenLocal()
}

uploadArchives {
	repositories {
//		flatDir {
//			dirs 'repos'
//		}
		
//		mavenDeployer {
//			repository(url: "file://localhost${System.env.HOME}/.m2/repository/")
//			pom.groupId = groupId
//			pom.artifactId = artifactId
//			pom.version = version
//		}
		
		mavenDeployer {
			configuration = configurations.deployerJars
			repository(url: "...") {
				authentication(userName: "...", password: "...")
			}
			pom.groupId = groupId
			pom.artifactId = artifactId
			pom.version = version
		}
	}
}

dependencies {
    // Dependencies not available from maven central
//	compile files("${System.env.HOME}/java/lib/oracle/ojdbc6.jar")
	
	// Dependencies for runtime
	
	compile 'org.hibernate:hibernate-core:4.0.1.Final'
	compile 'org.hibernate:hibernate-entitymanager:4.0.1.Final'
	compile 'com.mchange:c3p0:0.9.2.1'
	compile 'org.elasticsearch:elasticsearch:1.2.1'
	compile 'net.sf.ehcache:ehcache:1.5.0'
	compile 'log4j:log4j:1.2.17'
	compile 'org.slf4j:slf4j-api:1.7.6'
	compile 'org.slf4j:slf4j-log4j12:1.7.6'
	compile 'org.antlr:antlr:3.5.1'
	compile 'org.apache.hadoop:hadoop-core:1.0.3-mapr-3.0.1'
	compile 'org.apache.hbase:hbase:0.94.9-mapr'
	compile 'org.apache.zookeeper:zookeeper:3.4.5'
	compile 'com.fasterxml.jackson.core:jackson-core:2.2.0'
	compile 'com.fasterxml.jackson.core:jackson-databind:2.2.0'
	compile 'com.fasterxml.jackson.core:jackson-annotations:2.2.0'
	compile 'org.codehaus.jackson:jackson-mapper-asl:1.9.2'
	compile 'com.netflix.curator:curator-client:1.3.3'
	compile 'com.netflix.curator:curator-examples:1.3.3'
	compile 'com.netflix.curator:curator-framework:1.3.3'
	compile 'com.netflix.curator:curator-recipes:1.3.3'
	compile 'com.netflix.curator:curator-test:1.3.3'
	compile 'com.netflix.curator:curator-x-discovery:1.3.3'
	compile 'com.netflix.curator:curator-x-discovery-server:1.3.3'
	compile 'com.netflix.curator:curator-x-zkclient-bridge:1.3.3'
	compile 'org.hornetq:hornetq-core-client:2.2.14.Final'
	compile 'org.hornetq:hornetq-jms-client:2.2.14.Final'
	compile 'org.jboss.javaee:jboss-jms-api:1.1.0.GA'
	compile 'org.syslog4j:syslog4j:0.9.30'
	compile 'org.zeromq:jzmq:2.2.2'
	
	// Dependencies for testing
	
	testCompile 'junit:junit:4.11'
	
	// Dependencies for uploading archives (task dependencies)
	
	deployerJars 'org.apache.maven.wagon:wagon-http:2.2'
	deployerJars 'org.apache.maven.wagon:wagon-ssh:2.2'
	
	// Dependencies to include in the fat jar (separate configuration from :compile)
	
	// allJars project(':my-sub-project')
	// allJars 'some:dependency:0.0.0'
	// ...
}
